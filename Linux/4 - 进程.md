## Linux进程
进程一般分为交互进程、守护进程、批处理进程。

- 守护进程：该进程是活跃的，启动后会一直在后台进行，守护进程一般是系统在启动时通过脚本自动激活或超级管理用户root来启动的。

chkconfig --level 35 httpd on
// 将httpd服务设置在3、5系统模式下子启动

守护进程是一直运行在后台中，它的状态是等待请求处理任务状态，例如httpd服务，无论用户是否有访问网站，httpd服务器都会运行等待用户的访问来处理。、

##### 1. 进程的属性
- PID：进程id，是一个唯一的数值，用来区分进程，PPID是父进程。
- UID：启动进程的用户id
- GID：启动所属组的id

- 状态：进程的状态有运行中R，休眠S，僵尸状态Z（处于后台，但是没发挥作用）
- 优先级：我估计进程的优先级将决定cpu的先后使用权，优先级越高优先处理
- 终端名：即进程所连接的终端名字。

其他还有进程的资源占用，内存，cpu占用量等。

##### 2. 父进程与子进程的关系
父进程和子进程是管理和被管理的关系，当父进程终止时，子进程也随之被杀死，而子进程被终止，父进程并不一定终止。

比如httpd服务器运行时，我们可以杀死其子进程，但是父进程并不会因为子进程的终止而终止，在进程管理中，当发现占用资源多或无法控制的进程时，应该杀死他，以保护系统的稳定性。

##### 3. ps命令
ps，监视进程工具。
ps命令提供了进程的一次性的查看，它的输出结果不是动态连续的。

ps命令
```
用法
	ps 参数

参数说明
	a，显示所有用户的所有进程（包括其他用户）
	u，按用户名和启动时间的顺序来显示进程
	x，显示无控制终端的进程

	r，显示运行中的进程
	l，长格式输出
	
	j，用任务格式来显示进程
	f，用树形格式来显示进程	
	ww，避免详细参数被截断。

example:	
	ps -aux | more
	# 用|管道和more连接起来分页查看
	
	ps -aux > ps001.txt
	more ps001.txt
	# 将进程数据写入文件中，通过文件来查看。
	
	ps aux | grep httpd
	# 查看指定程序的进程
	
	ps uaxf | grep httpd
	# 父进程和子进程的关系友好判断的例子
	常用的选项是aux或lax，还有参数f的应用。
```
ps输出说明
- USER：进程的属主，进程是谁打开的。
- PID：进程的ID
- PPID：父进程的ID
- %CPU：占用cpu百分比
- %MEW：占用内存的百分比
- PRI：代表这个程序的可被执行的优先级
- NI：进程的NICE值，数值大，表示较少占用资源
- VSZ：进程占用的虚拟内存大小
- RSS：驻留中页的数量
- TTY，终端ID
- START：启动进程的时间
- WCHAN：正在等待的进程资源
- TIME：进程消耗CPU的时间。
- COMWAND：进程的名称和参数。

STAT是进程的状态，进程的状态有：
- D不间断的睡眠usually IO，
- R正在运行中在队列中可过行的，
- S处于休眠状态，
- T停止或被追踪，
- Z僵尸进程
- <优先级高的进程
- N优先级较低的进程
- L有些页被锁紧内存
- s进程的领导者（在它之下有子进程）
- +位于后台的进程组。

##### 4. pgrep
pgrep是通过程序的名字来查询进程的工具，一般是用来判断程序是否正在运行。
```
用法：
	pgrep [option] 程序名

参数选项：
	-l，列出程序名和进程ID
	-o，进程起始的ID，
	-n，进程终止的ID

example：
	pgrep -lo httpd

	pgrep -ln httpd

	pgrep -l httpd
```

##### 5. kill、killall、pkill
kill、killall、pkill 三个命令都是用于终止进程的。
一般kill的应用是和ps或pgrep命令结合在一起使用。

关于终止进程的说明：
服务器的父进程最好不要用这些命令来终止，例如通过这些命令来终止数据库服务器的时候，会让数据库产生更多的碎片，当碎片达到一定程度的时候，数据库就会有崩溃的危险，所以建议按照软件的正常程序来关闭。

当然对于占用资源过多的数据库子进程，我们应该用kill来杀掉。
```
用法：
	kill [新号代码] 进程ID

注：新号代码可以省略，常见的信号代码是-9，表示强制终止。

example：
	ps auxf |grep httpd
	# 你可以看到httpd的root父进程还有apache的子进程。
```
对于僵尸进程，可以用kill -9来强制终止退出，一个程序已经彻底死掉的话，kill不加信号强度是没办法退出的，最好是加信号强度-9

#### 6. top
top命令是动态监视系统任务的工具，它的输出结果是连续的。
可以用top命令看系统负载和进程的使用状态。

```
用法
	top [option]

参数选项
	-b，以批量模式运行，但不能接受命令行输入。
	-c，显示命令行，而不仅仅是命令名。	
	-i，禁止显示空闲进程或僵尸进程

	-n num，显示更新次数，然后退出，比如-n 5，表示top更细5次数据就退出。
	-d N，显示俩次刷新时间的间隔，比如-d 5，表示俩次刷新时间为5秒。
	-p PID，仅监视指定进程的ID；PID是一个数值。

	-q，不经任何延时就刷新
	-s，安全模式运行，禁用一些相互指令
	-S，累计模式，输出每个进程的总的CPU时间，包括已死的子进程。

example:
	top > mytop.txt
	# 将top命令的内容输出到文件中
```

##### 6.1 top命令所输出的内容可以通过一些命令来交互操作。
- space 立即更新
- c，切换到命令名显示，或显示整个命令（包括参数）
- f，F，增加显示字段或删除显示字段
- k，提示输入要杀死的进程ID，目的是用来杀死该进程（默认信号为15）
- i，禁止空闲进程和僵尸进程
- l，切换到负载平均值和正常运行的时间等信息
- m，切换到内存信息，并以内存占用大小排序。
- n，提示显示的进程数，比如输入3，就会在屏幕上显示3个进程
- o，0，改变显示字段的顺序。
- A，按进程生命大小排序，最新进程显示在最前。
- M，按内存占用大小排序，由大到小
- N，以进程ID大小排序，由大到小
- P，按CPU占用情况排序
- S，切换到累积时间模式
- T，按时间/积累时间对任务排序
- W，把当前的配置写到`/.toprc中

##### 6.2. top命令输出内容解析
输入top命令可以看到它的输出内容。

第一行的内容：
```
第一行的内容主要显示系统大概信息，大体如下所示：

10:00:23
# 当前系统时间

126days，14:00
# 系统持续运行的时间

2users
# 代表当前登录的用户数

load average
# load average后面的3个数字分别是1分钟，5分钟，15分钟的负载情况。
# load average数据是每隔5秒钟检查一次活跃的进程数，然后按照特定算法计算出的数值，
# 如果这个数除以逻辑CPU的数量，结果高于5的时候就表示系统已经在超负荷运载了。
```


第二行：进程说明
```
第二行数据是进程运行状态

tasks
# 任务（进程），系统现在有多少个进程，处于运行的有多少个

sleep
# 处于睡眠状态的进程个数

stoped
# 处于停止状态的进程个数

zombie
# 处于僵尸状态的进程的个数。
```


第三行：CPU状态
linux系统的CPU使用比率和windows概念不同，需要你了解用户空间和内核空间。

```
us
# 用户空间占用CPU的百分比

sy
# 内核空间占用CPU的百分比

ni
# 改变过优先级的进程占用CPU的百分比

id
#空闲CPU百分比

wa
#IO等待占用CPU的百分比

ni
#硬中断（Hardware IRQ）占用CPU的百分比

SI
#软中断（Software interrupts）占用CPU的百分比
```

第四行：内存状态
```
物理内存总量
使用中的内存总量
空闲内存总量
缓存的内存量
```
这里要说明的是不能用windows的内存概念理解这些数据。
第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，空闲内存总量（free）是内核还未纳入其管控范围的数量，纳入内核管理的内存不见得都是在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，

近似计算可用内存空间：第四行的free + 第四行的buffers + 第五行的cached。

对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。

linux是内核将内存加载进来，然后再有内核来进行分配内存空间，并不会放没使用的内存释放出来。

第五行：swap交换分区
```
交换区总量
使用的交换区总量
空闲交换区总量
缓冲的交换区总量
```

第七行：进程说明
这里能查看所有进程的各个属性状态
```
PID，进程ID
USER，进程所有者
PR，进程优先级
NI，nice值，负值表示高优先级，正值表示低优先级
VIRT，进程使用的虚拟内存总量，单位kb，
RES，进程使用的，未被换出的物理内存大小，这是真正使用到的内存大小。
SHR，共享内存大小，单位kb
S，进程状态，D=不可中断的睡眠状态，R=运行，S=睡眠，T=跟踪/停止,Z=僵尸状态

%CPU,上次更新到现在的CPU时间占用百分比
%MEM，进程使用的物理内存百分比
TIME，进程使用的CPU时间总计，单位1/100秒
COMMAND，进程名称
```
cpu的占用率，谁（进程）占用的时间越长，那么使用CPU占有率就越高。
命令的输入是使用shift+命令键位，q是退出

第一张完成...


