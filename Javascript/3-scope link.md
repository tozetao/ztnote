## 执行环境

### 1. 什么是执行环境
每个函数都是一个执行环境，它们都是独立的。
全局的执行环境依赖于宿主环境的实现，例如在web浏览器中，全局执行环境被认为是window对象，因为所有全局变量和函数都是作为window对象的属性和方法创建的。

### 2. 作用
执行环境（execution content）定义了变量或函数可访问范围，每个执行环境都会有一个对应的变量对象，在执行环境中创建的变量和函数都会附加在这个变量对象上。

某个执行环境中的代码执行完毕后，该执行环境会被销毁，且该环境的所有变量和函数定义也被销毁。

### 3. 环境栈
当代码执行流进入一个函数时，该函数的执行环境会被推进一个栈中并供当前函数使用，而在函数的代码执行之后，栈会将环境推出，把控制器交给之前的执行环境


## 作用域
当代码在一个执行环境中时，会创建一个变量对象的链表，我们将这个链表称为作用域链。
这个作用域链的当前节点始终都是当前代码所在环境的变量对象，它的上一个节点是外部执行环境的变量对象，上上个节点是上上一个外部执行环境的变量对象，一直延迟到全局执行环境。

代码在使用一个变量的时候，是根据作用域链一级一级向上搜索的，内部环境可以通过作用域链访问外部的所有执行环境，外部环境不能访问内部环境的任何变量和函数。
例如：
```javascript
var color = 'blue';

function changeColor(){
	color = 'yellow';
}
changeColor();
console.log(color);
```
通过作用域链改变外部作用域链中变量的值；

### 1. 没有块级作用域
JavaScript没有块级作用域的说法，例如
```javascript
if(true){
	var num=10;
}
alert(num);	//10
```
num变量会被添加到最近的执行环境中。

### 2. 初始化与执行环境
var声明的变量会被添加到最近的执行环境中，如果初始化变量时没有使用var声明，该变量会自动被添加到全局的执行环境中，例如：
```javascript
function add(num1, num2){
	var sum = num1+num2;
	return sum;
}
var result = add(10, 20);
console.log(sum);
```
拋出异常，因为有var关键字，sum变量属于add执行环境，如果不使用var关键字，则属于全局执行环境，代码将会正常运行。

注：不使用var关键字是一种不好的习惯。

### 3. 查询变量
在某个执行环境中，为了读取或写入时在引用一个变量的时候，会从当前作用域链向上搜索，如果在局部执行环境中找到，则停止搜索，否则会追溯到全局执行环境中，如果仍没有找到，则意味没声明该变量。

```javascript
var color = 'blue';
function getColor(){
	//var color = 'red';	//取消注释返回red
	return color;
}

alert(getColor());	//blue	
//从当前作用域链的变量对象中寻找变量的
```


## 垃圾回收
待定
