## MySQL用户权限

### 1. MySQL权限原理
MySQL权限判断分为2个阶段：
- 判断是否有用户连接，用户数据有host、user、passowrd，存储在mysql库user表中。
- 判断用户对数据库是否有操作权限，如果有再判断对数据库的表是否有操作权限

例如：
```sql
use mysql;

select host, user, password from user;
# 查询用户主机名、用户名和密码

update user set password=password('123') where user=xx;
#更改用户的密码

flush privileges;
# 冲刷权限，权限这种表是载入到内存中的，所以一定要冲刷权限。
```

### 2. 权限的授予与回收
数据库的权限存放在mysql库的db表中，表的权限存储在mysql库的table_priv表中。
### 创建用户
> 语法：create user user_name@address identified by password

- address：客户端ip地址，可以是通配符%，指定某个区段的ip地址或任意ip地址
- user_name：用户名
- IDENTIFIED BY：登录的密码

```sql
CREATE USER 'dog'@'localhost' IDENTIFIED BY '123456';

create user 'public'@'%' identified by 'public';
# 创建一个公共用户

select user,host,password from mysql.user;
# 查询mysql用户表

drop user ‘username’@’host’
# 删除用户
``` 

### 授予
> 语法：grant privileges... on database.table to user@host identified by pwd

grant关键字用于用户授权，grant关键字表示授予的意思，on指定在哪个数据库哪张表上的权限，to指定授予的用户和连接地点。
- privileges：指定权限
- user：用户名
- @host：客户端的主机地址
- identified by password：允许用户登录的密码

案例：
```sql
grant all on test.* to 'zhangsan'@'%' identified by '123123'
# 授予客户端ip地址是192.168.1.105
# 张三用户所有数据库所有表的操作权限，并以123密码登录

to myroot@192.168.1.%
# 允许192.168.1前缀的ip地址访问

to myroot@%
# 允许任何ip地址访问
```
常用的权限有：all、create、drop、insert、delete、select、update

### 回收权限
> 语法：revoke privileges on database.table from user@host

```sql
grant all on ecshop.* to test@'localhost'
# 在ecshop库授予所有表的权限

grant insert,update,select on ecshop.goods to lisi@'192.168.1.%'
# 授予goods表的权限

``` 
查看手册。

## 3. 找回密码
- 关闭mysql服务
- 设置登陆路跳过权限检测L：mysqld –skip-grant-tables
- 从新连接，重设密码

```sql
select user();--查询用户
use mysql;--
select user,password,host from user;--查询mysql用户

d.修改root用户的密码
update user set password =password('root') 
where user='root' and host='localhost';
f.退出服务器，重新启动服务器
```
