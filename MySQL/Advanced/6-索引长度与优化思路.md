## 索引长度
索引字段的长度决定了索引文件的大小，也影响增删改的速度，间接性的对查询速度也有影响。

索引字段的长度越短，索引的重复度就高，索引查询效率就低下，如果字段的长度过长，区分度高索引查询效果就越好，但是影响写入操作（增删改），所以索引字段的长度要有一个平衡。

### 1. 索引长度的平衡性
主要针对字符类型做一个平衡性，因为数字类型是固定长度的，不需要做索引长度方面的平衡。

索引长度的设置需要不断的测试，主要是通过截取字段的不同长度，计算区分度的一个平衡值，例如：
```sql
create table dict(
	id int primary key auto_incrment,
	word varchar(14) not null default '',
	key(word)
)engine myisam charset utf8;

# 随机插入若干数据

# 测试
# 从左边开始截取word字段的字符，截取个数从3开始，截取个数自己把握
# 使用distinct指令做一个去重处理，再计算非重复字段值的个数
# 将非重复字段值的个数数 / 总记录数，就能计算出所生成的索引值与总记录数的比值（即一个索引对应多少条记录）

# 说明：对于一般的系统，一个索引值（叶子节点）对应10条记录是能接受的，即1:10，当然如果区分度高且索引长度低，优先取精度高长度低的索引

select count(distinct left(column, 1)) / count(*)
# 0.1
select count(distinct left(column, 2)) / count(*)
# 0.5
select count(distinct left(column, 3)) / count(*)
# 0.91
select count(distinct left(column, 4)) / count(*)
# 0.92
# 像上述4个长度的索引且区分度达到0.91的当然是优先使用
```

ASCII码有26+26+10个字符，从62个字符中取6个字符来进行不重复组合，这个值是非常大的，相关计算看排列组合数学，一般的个人觉得取6个长度的字符来作为索引的长度就够了。
如果不够可以通过上述的测试去获取一个平衡的值。

注1：字符类型的索引数分裂效率是很低下的，所以千万不能在聚簇索引中使用字符类型，会影响插入效率，尤其是大量插入新纪录的场景下，innodb表的叶子分裂效率是很低下的。

注2：对于排列组合有兴趣的可以看：排列组合的数学公式

### 2. 索引长度创建技巧
由于索引是左前缀匹配，对于一些前缀重复高的值，我们可以通过程序控制颠倒字段的值，降

颠倒字段值：例如电话号码，前三位的重复度非常高，我们就可以颠倒号码的值来进行索引的建立。

伪哈希创建：存储一个伪哈希值，来降低他们的重复度，例如：
```sql
create table t9(
	id int primary key auto_increment,
	url varchar(50) not null default ''
)engine myisam charset utf8

alter table t9 add crcurl int unsigned not null default 0;
# 创建一个存储URL转哈希值的字段

# 存储时通过程序转换字段成哈希值
# 查询的时候将要查找的字段转成哈希值来进行查询，

select crc32('a');
update t9 set cucurl=crc32(url);
```


## 索引的重复与冗余

### 1.重复索引
指1个列或者顺序相同的几个列建立了索引，称为重复索引。
重复索引没有任何意义，建议删除，例如：
```sql
index s1（s）
index s2（s）

#通一个列建立了多个索引，这是无意义的。
```



### 2. 冗余索引
指2个索引覆盖的列有重复，例如：
例如，
```sql
key（x）
key（x，m）

# x列重复了

key（m，x）
# 这种情况下不是冗余所以，，因为俩者的列的顺序不一样。
```


### 3. 索引碎片

由于不断的删除记录或修改索引字段，这时候表和索引的查询效率会降低，
因为在长期的数据更改中，索引文件和数据文件都会产生空洞，形成碎片，所以我们需要定时修复。

主要通过一个nop操作（不产生实质影响的操作）来修改表，例如：
```sql
alter table xxx engine myisam
# 重置下存储引擎

optimize table tab_name
# 该命令也可以修复。

```

注意：修复表的数据或索引文件，就会把所有的数据文件重新整理一遍使之对其，如果表记录很多，很耗费资源，建议在夜间请根据自己的情况修复，一般几个月或半年一次修复。


## 高性能索引策略
1. 使用频繁
2. 区分度高
3. 长度小
4. SQL语句尽量索引覆盖

同时由于存储引擎对索引也有影响，在写入频繁的业务中根据情况选择对应的存储引擎，主要考虑叶子节点的分裂速度。
