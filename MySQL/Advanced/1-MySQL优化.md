## MySQL服务器优化思路

mysql服务器优化步骤：
1. 观察服务器状态
2. 是否有周期性故障
3. 是否有不规则延迟或卡顿
4. 查看mysql基准水平

### 1. 观察mysql服务器状态
通过脚本，刷新观察服务器status。

服务器状态的观察并不是一俩个小时就能查看出来的，往往你需要写一个脚本观察24小时甚至更久，主要观察是否有周期性的故障和波动。

### 2. 是否有周期性故障
一般来说周期性故障可能是在访问高峰或者缓存崩溃引起的，
碰到这种情况，建议加缓存更改缓存失效策略，使失效时间分散或夜间定时生效，这部分是在缓存方面排查。

### 3. 是否有不规则延迟或卡顿现象
不规则的卡顿或延迟一般是某条SQL语句写的不好，在这条语句查询的时候就会造成卡顿，这里可以通过开启慢查询或show processlist来获取有问题的SQL语句，再使用profiling或explain分析语句问题。

SQL语句主要俩个方面的问题：
- 语句等待时间长，这是io问题，通过调优服务器参数，例如mysql缓冲区，线程数
- 语句执行时间长，一般是设计缺陷，例如表关联多、索引没优化、语句没优化。

### 4. 测试mysql执行是否达标
如果你的mysql每秒I/O的流量大小已经接近服务器测试基准了，例如mysql每秒读取六七十M，而你的服务器的I/O每秒是70M，这时候需要加机器。

## 缓存案例解析
碰到一个问题，mysql负载监控曲线，平均每6小时就出现一次负载在300左右，就是没6个小时负载就非常高。

并发1200，俩台memcache、1台mysql，只要缓存一失效，服务器就挂了。

解决：
1. 把缓存随机设为3-9小时之间，使缓存失效相对分散，因为缓存时间是随机的，这是失效的缓存比较分散。
2. 做1个文件锁，请求要key时，上锁，如果有这个key，获取值解锁，如果没有这个key ->db -> 建立缓存再解锁。建立文件锁是为了在并发的时候有多个线程同时执行SQL语句获取缓存，避免造成浪费，只需要其中一个线程去连接数据库获取缓存即可，其他排队。
3. 在夜间凌晨的时候建立缓存，跑脚本。

这个案例是从缓存层面上来解决问题的。

## 我的疑问
mysql负载监控怎么做？

一台服务器的基准测试怎么做？
看查询速度呀，一台服务器每秒的读取数据流量大小是固定的，这个回头看脚本如何实现来测试。

基准测试，判断服务器的潜力