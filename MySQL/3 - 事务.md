隔离性与隔离级别

隔离性是指事务的ACIP中的I，即Isolation。

当数据库上有多个事务同时执行的时候，就会出现脏读、不可重复读、幻读等问题，隔离级别就是为了解决这些问题。要知道，隔离级别越高，运行效率就越低。

- 读未提交

  read uncommitted，一个事务在未提交时，它所做的更改可以被其他事务看到。

- 读提交

  read committed，一个事务的更改只有在提交时才能被其他事务看到。

- 可重复读

  repeatable read，一个事务执行过程中看到的数据，总是跟这个事务在启动时看到的数据时一致的。

  当然在可重复读隔离级别下，未提交的变更对其他事务也是不可见的。

- 串行花

  serializable，对于同一行记录，写会加写锁，读会加读锁。当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完成才能继续执行。



### example

设置事务的隔离级别

```sql
-- 设置当前回话的隔离级别
set session transaction isolation level repeatable read;

-- 当前回话的隔离级别
select @@tx_isolation;

-- 设置全局事务的隔离界别
set global transaction isolation level read committed;

-- 全局隔离级别
select @@global.tx_isolation;


select * from test where id = 1;
update test set name = 'qwer' where id = 1;
```



案例说明：

|        事务A        |        事务B        |
| :-----------------: | :-----------------: |
| 启动事务，查询A的值 | 启动事务，查询A的值 |
|                     |   将A的值由1该为2   |
| 查询A的值，得到值a  |                     |
|                     |      提交事务       |
| 查询A的值，得到值b  |                     |
|        提交         |                     |
| 查询A的值，得到值c  |                     |

- 如果隔离级别是"读未提交"，事务A的值a、值b和值c都是2。

- 如果是"读提交"级别，值a是1，值b是2，值3是2。
- 如果是"可重复读"，值a和值b是1，值c是2。
- 如果是"串行化"，事务B在更改时会被锁住，直到事务A执行完毕后才允许事务B执行。所以值a和值b是1，值c是2.

