扫描行数

在执行一条SQL语句时，MySQL也不知道满足这个条件的记录会有多少条。





优化器的工作：

扫描行数、是否排序、是否使用临时表等因素都是SQL语句执行的代价。优化器会找到一个最优的执行方案，用最小的代价来执行语句。



如何判断扫描行数?

根据索引的基数来估算要扫描的记录数。

对于一个具体的语句，优化器会预估语句要扫描的行数是多少。通过explain命令来分析语句，rows字段是预计扫描的行数。



开启一致性视图，扫描行数变为了100000；没开启的话是10000。

开启视图后，一份数据就变为俩份数据了，





索引的基数

索引上不同的值的个数，称为基数（cardinality）

```sql
show index from table_name;	-- 显示一个表的索引信息，包括cardinality
```

MySQL时通过采样统计来计算cardinality的，InnoDB默认会选择N个数据页，统计这些页上的不同值，得到一个平均值，然后乘以这个索引的数据页个数，就计算出该索引的cardinality。

而数据表是会变更的，索引统计信息也会发生变化，所以当变更的数据行数超过$1/M$时，会自动触发一次索引统计。

在MySQL中有俩种方式存储索引统计，可以通过设置innodb_stats_persistent参数：

- 设置为on时，表示统计信息会持久化存储。这时默认N是20，M是10。
- 设置为off时，表示统计信息只存储在内存中。这时默认N是8，M是16。





note：变更的数据行应该指的是新增或删除的记录数，超过1/M是指超过表的基数的1/M。







analyze table tab_name

重新统计表的索引信息，解决索引统计信息不准确。





优化器是有可能选错索引来执行的。