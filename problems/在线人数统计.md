在线人数的统计实现：

后台redis维护session_id的最后更新时间



我就问了一个问题 如何统计出网站的在线人数？  到现在 还没有我满意的答案。都要我引导下去说

这个要先定义什么是离线状态

后台redis 维护 session_id 的最后 更新时间

前台ajax 发送心跳包更新 时间

然后后台crontab 统计

ip不等于用户

心跳 + mysql 就好了啊 。。。。。。

where last_online_time > now（）- 60s

因为发送心跳的时间 量比较大 mysql 可能会撑不住

大概这样一句sql就是方案了嘛，剩下的是实现细节
不会撑不住啊 o（1） 的 update 而且不会大量锁冲突

我觉得吧，首先要问清楚面试官是在线还是离线统计，其次要看是实时还是非实时以及数据规模、保存时间等要求。办法有很多的，比如用监听器+MQ+bitmap也可以，也可以用MQ+LOG+ES

关键还是要细化下来。

如果你说实时统计在线人数，QPS平均水位在200和2000用的方案肯定是不同的

除了需求之外还要确定需求规模

因为很多问题其实没有唯一解或者有很多解的，如果不能把需求、场景、规模等多维度信息结合起来，你出的解决方案很可能只是局部最优解全局最差解。所以要是面试我的话得做好被各种反问的准备

而且我一般给出虚拟场景的答案也不会只给一个，一般会有1、人力时间充足的方案  2、业务最小侵入解 3、性能较好解 等等

所以友情建议，面试官提问之后别急着立刻答，先把多个维度信息逐步问出来补全场景。然后制定几套方案来回答

