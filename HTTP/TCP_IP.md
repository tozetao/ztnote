### TCP/IP协议族

计算机与网络设备相互通信所制定的规则叫做协议；TCP/IP是互联网相关的各类协议族的总称，例如HTTP、FTP、TCP、UDP等协议属于TCP/IP协议族的子集。

TCP/IP协议族最重要的一点就是分层，各层之间的接口规范定义好后，如果某个层设计有变动，因为是通过接口进行交互所以只需要在有变动的层进行改动即可，不会影响到其他层，按照层次能够分为：

- 应用层

  向用户提供应用服务时通信的活动，例如HTTP，FTP，DNS等服务

- 传输层

  传输层对应上层应用层，它提供俩台计算机之间数据交互的传输，在传输层有俩个性质不同的协议TCP(传输控制协议)和UDP(用户数据报协议)

- 网络层

  网络层是用来处理网络上流动的数据包，数据包是网络传输的最小数据单位。该层定义了通过哪条传输路线到达对方计算机并把数据包发送给它

- 数据链路层

  硬件范畴都属于数据链路层，用于处理连接网络的硬件部分

  ​

#### TCP/IP通信传输流

利用TCP/IP协议族进行网络通信时，会通过分层顺序与对方进行通信。发送端向下层走，接收方往上层走。例如HTTP协议，它的通信流程如下：

- 在应用层客户端通过HTTP协议发送一个请求
- 传输层也就是说TCP协议会将应用层传输过来的数据(HTTP报文)进行分割，并在各个报文上标记序号及端口号转发给网络层
- 在网络层(IP协议)，增加通信目的地MAC地址后转发给链路层

这样发往网络的通信就准备完毕，接收端的服务器在链路层收到数据后，会按序向上发送知道应用层才能真正接收到客户端传输过来的数据。



#### IP协议

TCP/IP协议族中的IP就是指IP协议，叫做网际协议。

IP协议位于网络层，负责把各种数据包发送给对方；网络层最重要是确定IP地址与MAC地址，IP地址指定了发送的节点地址，MAC地址指定网卡所属的固定地址。

IP间的通信依赖于MAC地址，通信一般会经过多台计算机和网络设置中传才能连接到对方，在进行中转时会利用下一台中转设备的MAC地址来搜索下一个中转目标(IP地址)，在中转到下一个目标时会利用ARP协议根据MAC地址反查出下一个中转目标的MAC地址，再进行中转。



#### TCP协议

TCP协议位于传输层，它主要对网络层提供可靠的字节流服务。

- 字节流

  为了传输方便，将大块数据切割成报文段为单位的数据包进行管理。

- 可靠

  能够把数据准确的传输给对方

简单的说TPC协议为了更容易传送大数据才把数据进行分割，而且TCP协议能够确保数据最终是否送达到对方。

为了准确将数据传输给对方，TCP协议采用三次握手策略。在发送数据包后，TCP会想对方确认数据是否发送成功。握手过程中使用了TCP的标志（flag)） - SYN（synchronize）- 和ACK（acknowledgement），具体握手流程如下：

- 发送端首先发送一个带SYN标志的数据包给对方
- 接收端收到后数据包，回传一个带有SYN/ACK标志的数据包表示传达收到信息
- 最后发送端再次发送一个带ACK标志的数据包，代表握手结束



#### DNS协议

DNS服务时和HTTP协议一样位于应用层的协议，DNS协议提供通过域名查询IP地址，或逆向通过IP地址反查域名地址。



各个协议之间的关系示例，假设客户端访问域名：www.abc.com

- DNS协议解析域名对应的IP地址x.x.x.x
- 在应用层通过HTTP协议发送请求报文
- 在传输层TCP协议将报文切割成报文段，按照序号划分，再将报文段可靠的传输给对方
- 网络层IP协议负责搜索对方IP地址，一边中传一边传输数据
- 服务端传输层的TCP协议收到多个报文段，将按序号重新组合成完成保证，传输给应用层
- WEB服务器处理请求并进行响应，相应结果也是利用TCP/IP通信协议向用户应答

