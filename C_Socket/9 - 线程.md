线程被称为轻权进程（lightweight process），线程的创建可能比进程的创建快10-100倍。

同一进程内的所有线程共享相同的全局内存。这使得线程共享数据非常简单，然而会带来同步问题。



同一进程内的所有线程可共享的内容有：

- 全局变量
- 进程指令
- 打开的文件描述符
- 信号处理函数和信号设置
- 当前工作目录
- 用户ID和组ID

不过每个线程有各自的：

- 线程ID
- 寄存器集合，包括程序计数器和栈指针
- 栈空间（存放局部变量和返回地址）
- errno
- 信号掩码
- 优先级



### 线程的初始化

当一个程序由exec启动执行时，称为初始线程或主线程的单个线程就创建了，其余的线程都是通过pthread_create创建的。

创建一个线程时我们会指定要执行的函数及其参数，线程会通过调用该函数开始执行，该函数执行完毕后线程终止，也可以通过调用pthread_exit显示的终止线程。

```c
#include <pthread.h>

int pthread_create(pthread_t *tid, pthread_attr_t *attr, void *(* func)(void *), void *arg)
```

- tid

  每个线程由tid标识，如果线程创建成功，其ID就通过tid指针返回。

- attr

  线程是有属性的：优先级、初始栈大小，是否应该成为一个守护线程等等。attr参数用于指定初始化线程时的属性。

- void \*(\* func)(void *)

  该参数是一个参数为void指针，返回值为void指针的函数指针。

  该函数一般是线程的执行逻辑。

- arg

  arg参数是第三个参数函数指针的参数，通过arg参数可以指定函数指针参数的数据。

pthread_create()执行成功返回0，失败返回一个非0的错误值。



```c
#include <pthread.h>

int pthread_join(pthread_t *tid, void **status);
```

pthread_join用于等待一个给定线程停止，类似waitpid系统调用。但是Pthread必须指定要等待的线程，无法等待任意结束的线程。

- status

  一个指向某个对象的指针，如果status非空，来自所等待线程的返回值将存入由status指向的位置。



### 可汇合与脱离

当一个可汇合的线程终止时，它的线程ID和退出状态将留存到另一个线程对它调用pthread_join。而一个线程如果时脱离的状态，它就像守护进程，当它终止时，所有相关资源都被释放，我们不能等待它们终止。

```c
int pthread_detach(pthread_t tid);
```

成功返回0，失败返回错误为正的值。