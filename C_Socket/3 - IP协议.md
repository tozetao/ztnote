### IP协议

IP协议是TCP/IP协议族中的核心协议。

IP数据包的路由和转发发生在除目标机器之外的所有主机和路由器上，它们决定数据包是否应该转发以及如何转发。

每个IP数据报都有IP头部信息，用于指定IP通信的源端IP地址和目标端IP地址，指导IP分片和重组，以及指定部分通信行为。

IP协议的特点是无状态和不可靠。

- 无状态

  数据报的发送、传输和接受都相互独立，没有上下文关系。发送的数据报是乱序的也可能是重复的，接收端无法处理乱序和重复问题。

  只要接受到数据报就给上层协议处理，因此上层协议需要处理这些乱序和重复的IP数据报，比如TCP协议就能处理这些IP数据报，保证数据是有序的、正确的。

- 不可靠

  不保证IP数据报能准确的到达接收端。

优点是简单、高效，无需为保持通信的状态而分配一些内核资源，传输数据时也无需携带状态信息。



### IP头部

待填坑



### IP分片

待填坑



### IP路由

待填坑



tcpdump -x，可以以16禁制显示IP数据包，前20个字节是IP头部信息，后40个字节是TCP头部信息







### ICMP协议

Internet Control Message Protocol，用于检测网络连接，是IP协议的补充。

ICMP协议报文是由32位（4个字节）报头和报文内容组成。

报头的组成如下：

- 8位类型

  8位类型字段用于区分报文类型，可分为俩类，一类是差错报文，这类报文主要用于回应网络错误；一类是查询报文，这类报文用于查询网络信息，比如ping程序就是使用ICMP报文查看目标是否可到达（类型值为8）。

- 8位代码

- 16位校验和

  16位校验和字段用于对整个报文（报头和内容）进行循环冗余验证（CRC），以检查报文在传输过程中是否损坏。

