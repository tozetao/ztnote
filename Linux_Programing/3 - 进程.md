进程是一个可执行程序的实例。



### 程序

程序是一系列信息的文件，这些信息描述了如何在运行时创建一个进程，具体内容包括：

- 二进制格式标识
- 机器语言指令
- 程序入口地址
- 数据：变量初始值和字面量
- 符号表和重定向表
- 共享库和动态链接信息
- 其他略

可以用一个程序来创建许多进程，或者说许多进程运行的是同一程序。



### 进程

进程是由内核定义的抽象的实体，并未该实体分配用以执行程序的各项系统资源。

在内核角度来看，进程由用户内存空间（user-space memory）和一系列内核数据结构组成。用户内存空间包含程序代码和代码使用的变量。内核数据结构用以维持进程状态信息，记录在内核数据结构的信息有：进程相关标识号（IDs）、虚拟内存表、打开文件的描述符表、信号传递以及处理的有关信息、进程资源使用限制等大量信息。



### 进程号

```c
#include <unistd.h>

pid_t getpid(void);
```

获取一个进程的pid。

每个进程都有一个进程号，它是一个正数。linux内核创建一个进程时，会分配下一个可用的进程号给其使用，在linux2.4之前的版本32位平台的进程号是小于等于32767，linux2.6版本的64位平台的进程号最大值可达$2^{22}$，如果进程号超过最大值，那么将会重置到300再循环使用。

除了少数系统进程外，程序与运行该程序的进程号无任何关系，一般的分配1-300给系统进程和守护进程使用。



```c
#include <unistd.h>

pid_t getppid(void);
```

返回一个进程的父进程id。

每个进程的父进程号属性反应了系统上所有进程间的树状关系，进程的始祖进程是init进程。如果父进程终止则子进程会变成孤儿进程，init进程随后会接管该子进程。



进程内存布局

每个进程所分配的内存是由很多段（segment）组成，包括有：

- 文本段

  包含进程运行的程序机器语言指令，文本段是只读的，这是为了防止进程错误的指针修改到指令；文本段是共享的，一份程序代码的拷贝可以映射到所有这些进程的虚拟地址空间。

- 初始化数据段

  包含程序显式初始化的静态变量和全局变量，程序在加载到内存时就会从可执行文件中读取这些变量的值。

- 未初始化数据段

  包含未进行显式初始化的静态变量与全局变量，程序启动之前系统会将本段全部初始化为0，该段也被称为BSS。

  将静态变量、全局变量初始化和未初始化分开，主要是因为程序存储在磁盘时没必要为未初始化的静态变量和全局变量分配空间，程序运行时再分配存储空间即可。

- 栈

  栈是由栈帧组成，它是一个动态增长和收缩的段。

- 堆

  可在运行时为变量动态进行内存分配的一块区域，堆顶称为program break。

对于初始化和未初始化的数据段而言，表达更信息的称谓分别是用户初始化数据段（user-initialized data）和零初始化数据段（zero-initialized data）。



x86-32体系结构中的内存段布局

各个段的布局从上到下分别有：

- argv、environ，顶部空间，用于存储程序命令行实参和进程环境列表。
- 栈，向下增长
- 堆，向上增长



栈帧



对于频繁使用的变量，编译器优化时会将其分配到寄存器中。