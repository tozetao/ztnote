## 控制台命令程序

### 1.概念
控制台程序，这种程序没有可视化窗口界面，只有命令控制窗口，通过输入命令来执行程序，程序执行后也是用字符串来显示执行后的结果。

### 2.创建控制台命令程序
- 控制台命令程序继承自yii\console\Controller控制器类
- 在控制器类中，定义一个或多个动作，动作是与控制器子命令相对应的。
- 在动作方法中实现业务需求

这3个步骤大体就创建一个控制台控制器程序了。

### 3. 控制台入口脚本
在yii框架的根目录下，yii即时控制台命令程序的入口脚本文件，代码大体与web应用程序的入口文件一致。

第一行的程序是表示用php解释器来执行脚本文件。
```php
#!/usr/bin/env php
```


### 4.控制台命令
- 通过web根目录下yii脚本来执行控制台命令程序
- yii脚本命令，控制器ID/动作ID

### 有参数的命令
yii controller/action param1 param2
传递多个参数

yii controller/action param1,param2
传递数组参数

### 有选项的命令
yii controller/action --options=value
选项需要以--开头，options是选项名，value是选项值

选项是可以设置别名的，通过重写optionsAliases()方法定义选项的别名：
```php
class HelloController extends Controller
{
	public $rev;
	
	public function options()
	{
		return ['rev'];
	}
	
	public function optionAliases()
	{
		return['r'=>'rev'];
	}
}
```


### 5.控制台命令退出代码
执行成功返回0，如果失败则返回非0数字，一般会定义非0数字的错误代码，用以调适信息。

在yii中，实现退出代码就是在控制器动作方法中返回一个整数就可以了。

### 6. 控制台命令程序适用场景
- 适合在操作系统级别执行的程序
- 定时执行的任务，例如定时生成日报表、月报表

像批量发送短信或者邮件这种需求，使用web应用程序来解决是会出现出题，1是批量发送邮件或者短信，在发送量非常大的情况下是非常耗时的，web应用的执行进程是有时间限制，会出现超时，2是发送短信有些能执行成功，有些会发送失败，web程序也很难去跟踪控制发送的状态。

这个时候用控制台应用程序就能够很好的解决。

### 6. crontab
定时执行任务命令，这是linux系统的专有命令。
```
crontab -e
# 执行该命令后将会出现一个输入窗口，编写执行代码

*/3***** /var/www/yii2blog/yii sms/send >> /temp/sms.log
# 这段代码表示每隔3分钟就会执行这段代码

执行成功linux会将其添加到定时任务中。
```