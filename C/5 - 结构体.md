C语言提供了俩种聚合数据类型，数组和结构。数组是相同类型值的集合，而结构是不同类型值的集合。

结构是一些值的集合，这些值被称为成员，在结构中成员可以有不同的类型



### 声明

```c
struct tag { mumber-list } variable-list;
```

tag是标签名，可以认为是结构体的名字；member-list是成员列表，成员由类型与变量名组成；variable-list是结构变量列表，即所声明结构的变量名。



- tag的声明方式

  ```c
  struct SIMPLE {
      int a;
      float b;
      char c;
  };
  ```

  这种声明方式将标签与成员列表绑定在一起了，我们可以通过标签来创建变量。

  ```c
  struct SIMPLE x;
  struct SIMPLE y[20], *z;
  //x,y,z都是同一种类型的结构变量
  ```


- typeof的声明方式

  ```c
  typedef struct {
      int a;
      char b;
      float c;
  }Simple;
  ```

  这种声明方式相当于创建了一种新的类型，这是Simple是一种类型而不是个结构标签。

  ```c
  Simple x;
  Simple y[20], *z;
  ```



### 初始化

结构体的初始化与数组一样，在一对大括号中编写初始值的列表。

这些值根据成员列表的顺序进行初始化，如果初始列表的值不够，剩余成员变量将使用默认值进行初始化。

```c
struct INIT_EX {
    int a;
    short b[10];
    Simple c;
} x = {
    100,
    {1,2,3,4,5,6},
    {1, 10.85, 'c'}
};
```





### 成员的访问

结构成员不仅可以是标量类型，也可以是数组或其他结构体类型。

访问结构体成员是通过点操作符，点操作符接受俩个操作数，左操作数是结构体变量名，右操作数是要访问的成员的名字。

注：点操作符与下标操作符的优先级是相同的，因此结合性是从左往右的

```c
typedef struct {
    int i;
    float f;
}Simple;

typedef struct {
    float f;
    int i;
    Simple sa[10];
    Simple *sp;
}Complex;

Complex comp;

//直接访问
comp.i;

//访问结构体数组类型的成员变量
comp.sa[4].f;
```



指向结构的指针的访问

```c
(*comp.sp).i;
//首先对指针执行间接访问操作获得该结构，然后使用点操作符来访问成员变量，由于点操作符的优先级高于间接访问操作符，因此需要加小括号。

//上述的访问很繁琐，因此C提供箭头操作符来访问成员变量
comp->sp->i;
```



### 自引用

结构体的自引用指成员变量的类型是该结构体本身。

```c
struct Node {
    int a;
    int b;
    struct Node *n;
};
```

要注意的是自引用结构体必须是指向结构的指针而不是一个结构体，对于指向结构的指针在编译阶段可以确定该结构指针的长度，如果成员变量是结构体类型将会形成死循环声明，这是错误的。

example：

```c
typedef struct {
    int a;
    SELF_REF *b;
} SELF_REF;
//错误的声明方式，该类型名直到声明的末尾才定义，对于结构体内部是未知的，因此错误。

typedef struct SELF_REF_TAG {
    int a;
    struct SELF_REF_TAG *b;
} SELF_REF;
//正确的声明方式
```



### 不完整声明

不完整声明主要用于解决俩个结构体相互依赖，例如A结构的成员是B结构体，而B结构体的成员是A结构体。

```c
struct A;

struct B {
    struct A *parent;
};

struct A {
    struct B *parent;
};
```

在B的成员列表里需要标签A的不完整声明，B在声明之后，就可以在A的成员列表里声明。



### 结构与指针

指向结构的指针作为左值和右值的情况：

```c
typedef struct {
    int a;
    short b[2];
}Child;

typedef struct  Ex{
    int a;
    char b[3];
    Child c;
    struct Ex *p;
}Ex;

Ex ex = {
    100,
    "Hi",
    {1, {-1, 35}},
    0
};
Ex *px = &ex;

px;
//px是一个指针变量，作为右值时值是px的内容，作为左值时表示px的旧值会被新的值代替

*px;
//作为右值时，*px表示整个结构体，等价于变量ex；
//作为左值时，表示该结构会接收一个新值，更准确的说是所有成员会接收新的值，作为左值重要的是内存地址。
```






