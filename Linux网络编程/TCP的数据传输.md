

### 流量控制

单个连接在发送和接收数据是按照什么规则来进行的？

这里引入发送窗口和接收窗口，它们是TCP连接的双方，一个作为生产者，一个作为消费者，控制传输数据时的生产、消费速率。

TCP发送端就是生产者，而接收方就是消费者。

消费者在未消费完数据的情况下，如果生产者继续发送数据，这回导致消费者来不及消费而丢弃掉接收的数据。从而是的生产者继续重传数据，导致网络繁忙。

这里消费者来不及消费的意思是，接收方没办法再从缓冲区腾出一定的位置来放置数据。





### 拥塞窗口

TCP数据包是要经过网络设备的，而网络设备本身的带宽也是有限的，为了协调多个连接的数据包在网络设备上的传输，就是拥塞窗口要解决的问题。



TCP有自己实现了拥塞控制算法，这里不去深入了解，只需要知道TCP会不断探测网络状态，并随之不断调整拥塞窗口的大小。

还要了解一点的是，TCP发送缓冲区的数据能否真正发送出去，至少取决于俩个因素，一个是当前的发送窗口大小，另外一个是拥塞窗口的大小。TCP协议是取俩个窗口中更小值作为判断，来决定是否能够发出数据。



总结：发送窗口是解决单个连接中，点对点之间的流量控制模型，它是需要和接收端来一起共同协调来调整大小的；而拥塞窗口是作为多个TPC连接共享网络贷款的拥塞控制模型，它是发送端独立的根据网络状况来调整的。





### Nagle

这个算法的本质是限制发送端大批量发送小数据包。

在任何一个时刻，未被确认的小数据包不能超过一个。这里的小数据包，指的是长度小于最大报文段长度MSS的TCP分组。

这样发送端就可以把接下来连续的几个小数据包存储起来，等待接收到前一个小数据包的ACK分组之后，再将数据一次性发送出去。





### 延时ACK

在收到数据后并不马上回复，而是累计需要发送的ACK报文，等到有数据要发送给对端时，将累计的ACK一并发送。



总结：Nagle是对发送端发出数据包的优化，而延迟ACK是对接收端频繁响应ACK的优化。